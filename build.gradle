plugins {
    id 'idea'
    id 'jacoco'
    id 'jacoco-report-aggregation'
    id "maven-publish"
    id "org.sonarqube"
    id 'org.springframework.boot'
    id 'io.spring.dependency-management'
}

ext {
    AZURE_SPRING_VERSION = "5.1.0"
    APACHE_COMMONS_COLLECTIONS_VERSION = "4.4"
    APACHE_COMMONS_COMPRESS_VERSION = "1.26.1"
    APACHE_COMMONS_LANG_VERSION = "3.14.0"
    APACHE_POI_VERSION = "5.2.5"
    APACHE_TOMCAT_VERSION = "10.1.19"
    GOOGLE_AUTO_SERVICE_VERSION = "1.1.1"
    GOOGLE_FIND_BUGS_VERSION = "3.0.2"
    GOOGLE_GSON_VERSION = "2.10.1"
    GOOGLE_TESTING_COMPILE_VERSION = "0.21.0"
    GOOGLE_TRUTH_VERSION = "1.4.2"
    GRADLE_VERSION = "8.6"
    HAMCREST_VERSION = "1.3"
    HIBERNATE_JPA_MODELGEN_VERSION = "6.3.1.Final"
    JAVA_VERSION = "21"
    JAVA_SOURCE_COMPATIBILITY = JAVA_VERSION
    JAVA_TARGET_COMPATIBILITY = JAVA_VERSION
    JSON_VERSION = "20240303"
    JSON_PATH_VERSION = "2.9.0"
    LOGBACK_VERSION = "1.5.3"
    LOMBOK_VERSION = "1.18.30"
    LOMBOK_MAPSTRUCT_VERSION = "0.2.0"
    MAPSTRUCT_VERSION = "1.5.5.Final"
    MODELMAPPER_VERSION = "3.2.0"
    OPTIONS_ENCODING = "UTF-8"
    POSTGRES_VERSION = "42.7.2"
    RESTASSURED_VERSION = "5.4.0"
    SNAKE_YAML_VERSION = "2.2"
    SPRING_BATCH_EXCEL_VERSION = "0.1.1"
    SPRINGDOC_VERSION = "2.3.0"
    SPRING_SECURITY_VERSION = "3.1.0"
    SQUAREUP_JAVAPOET_VERSION = "1.13.0"
    TESTCONTAINERS_VERSION = "1.19.7"
}

Properties env = new Properties()
File subPropertiesFile = new File("$projectDir/env.properties")
subPropertiesFile.withInputStream {
    env.load(it)
}

ext.JAVA_VERSION = JavaVersion.toVersion(env.JAVA_VERSION)
ext.JAVA_SOURCE_COMPATIBILITY = env.JAVA_VERSION
ext.JAVA_TARGET_COMPATIBILITY = env.JAVA_VERSION
ext.OPTIONS_ENCODING = env.ENCODING

wrapper {
    gradleVersion = GRADLE_VERSION
    distributionType = Wrapper.DistributionType.ALL
}

allprojects {
    apply plugin: 'org.sonarqube'
    apply plugin: 'jacoco-report-aggregation'

    group = env.APPLICATION_GROUP
    version = env.APPLICATION_VERSION

    repositories {
        mavenCentral()
    }

    publishing {
        repositories {
            maven {
                name = "GitHubPackages"
                url = uri("https://maven.pkg.github.com/billybolton/springharvest")
                credentials {
                    username = project.findProperty("gpr.user") ?: System.getenv("GITHUB_ACTOR")
                    password = project.findProperty("gpr.key") ?: System.getenv("GITHUB_TOKEN")
                }
            }
        }
    }

}

subprojects {
}
